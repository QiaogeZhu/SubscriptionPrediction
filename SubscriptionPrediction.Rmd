---
title: "Subscription Prediction"
output: html_document
---

# Data Explanation

This dataset has been dowloaded from UCI Machine Learning Repository. "The data is related with direct marketing campaigns of a Portuguese banking institution. The marketing campaigns were based on phone calls. Often, more than one contact to the same client was required, in order to access if the product (bank term deposit) would be ('yes') or not ('no') subscribed." (See https://archive.ics.uci.edu/ml/datasets/bank+marketing). See also the `dataset_description.txt` and `attribute_info.txt` for explanation of the datasets and variables.

# Data Preparation

```{r}
# libraries
library(dplyr)
library(naniar)
library(visdat)
library(mice)
library(ggplot2)
```

```{r}
# read the data
data = read.csv("bank-additional/bank-additional-full.csv", sep = ";")
```

Take a look at the data:

```{r}
summary(data)
```

We find that there are some variables with level _unknown_, which should be treated as missing values.

## Missing value

```{r}
# number of missing values
sum(is.na(data))
```

There is no "direct" missing value in the dataset. However, as we mentioned above, the entries marked as _unknown_ should be treated as missing values. We replace all entries with _unknown_ as NA.

```{r}
data[data == "unknown"] = NA
```

Let's plot the missing values.

```{r}
vis_miss(data)
```

There are a few missing values associated with `job`, `marital`, `education`, `housing`, `loan`. But there are 20.87% missing values for `default`.

We use the `mice` package to impute the missing values.

```{r, eval = FALSE}
imputed_data = mice(data, maxit = 1, method = 'pmm', seed = 6)
data = complete(imputed_data)

# save the data
# write.csv(data, "cleaned_data_additional_full.csv")
```

```{r}
# Now we can read the data directly
data = read.csv("cleaned_data_additional_full.csv")[,-1]
head(data)
```

## Variable Exploration

### age

How is `age` distributed and how is it related to `y`?

```{r}
# distribution of variable age
ggplot(data, aes(x = age, color = y)) + geom_histogram(fill = "white", alpha=0.5, position="identity")
```

We can see that most of the potential subscribers are middle-aged. It also seems that even though most potential subscribers are middle-aged, the proportion of these people actually subscribed are comparably low. The proportion of young people and old people subscribing are high, but proportionally we do not have a lot of such customers.

## Job

How is `job` related to `y`?

```{r}
ggplot(data, aes(fill=y, y=..count.., x=job)) + 
    geom_bar(position="stack", stat="count") + 
    coord_flip()
```

Looks like the proportion of retired and student subscribers are also optimal.

## marital status

```{r}
ggplot(data, aes(fill=y, y=..count.., x=marital)) + 
    geom_bar(position="stack", stat="count")
```


## education

```{r}
ggplot(data, aes(fill=y, y=..count.., x=education)) + 
    geom_bar(position="stack", stat="count") +
  coord_flip()
```

# Modeling



# Results