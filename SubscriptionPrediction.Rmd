---
title: "Subscription Prediction"
output: html_document
---

# Data Explanation

This dataset has been dowloaded from UCI Machine Learning Repository. "The data is related with direct marketing campaigns of a Portuguese banking institution. The marketing campaigns were based on phone calls. Often, more than one contact to the same client was required, in order to access if the product (bank term deposit) would be ('yes') or not ('no') subscribed." (See https://archive.ics.uci.edu/ml/datasets/bank+marketing). See also the `dataset_description.txt` and `attribute_info.txt` for explanation of the datasets and variables.

# Data Preparation

```{r}
# libraries
library(dplyr)
library(naniar)
library(visdat)
library(mice)
library(ggplot2)
```

```{r}
# read the data
data = read.csv("bank-additional/bank-additional-full.csv", sep = ";")
```

Take a look at the data:

```{r}
summary(data)
```

We find that there are some variables with level _unknown_, which should be treated as missing values.

## Missing value

```{r}
# number of missing values
sum(is.na(data))
```

There is no "direct" missing value in the dataset. However, as we mentioned above, the entries marked as _unknown_ should be treated as missing values. We replace all entries with _unknown_ as NA.

```{r}
data[data == "unknown"] = NA
```

Let's plot the missing values.

```{r}
vis_miss(data)
```

There are a few missing values associated with `job`, `marital`, `education`, `housing`, `loan`. But there are 20.87% missing values for `default`.

We use the `mice` package to impute the missing values.

```{r, eval = FALSE}
imputed_data = mice(data, maxit = 1, method = 'pmm', seed = 6)
data = complete(imputed_data)

# save the data
# write.csv(data, "cleaned_data_additional_full.csv")
```

```{r}
# Now we can read the data directly
data = read.csv("cleaned_data_additional_full.csv")[,-1]
head(data)
```

## Variable Exploration

### age

How is `age` distributed and how is it related to `y`?

```{r}
# distribution of variable age
ggplot(data, aes(x = age, color = y)) + geom_histogram(fill = "white", alpha=0.5, position="identity")
```

We can see that most of the potential subscribers are middle-aged. It also seems that even though most potential subscribers are middle-aged, the proportion of these people actually subscribed are comparably low. The proportion of young people and old people subscribing are high, but proportionally we do not have a lot of such customers.

## Job

How is `job` related to `y`?

```{r}
ggplot(data, aes(fill=y, y=..count.., x=job)) + 
    geom_bar(position="stack", stat="count") + 
    coord_flip()
```

Looks like the proportion of retired and student subscribers are optimal.

## marital status

```{r}
ggplot(data, aes(fill=y, y=..count.., x=marital)) + 
    geom_bar(position="stack", stat="count")
```


## education

```{r}
ggplot(data, aes(fill=y, y=..count.., x=education)) + 
    geom_bar(position="stack", stat="count") +
  coord_flip()
```

## default

```{r}
ggplot(data, aes(fill=y, y=..count.., x=default)) + 
    geom_bar(position="stack", stat="count")
```

Looks like only few observations have `default` = yes. We look at these observations.

```{r}
# observations where default = yes
data$y[data$default == "yes"]
```

Most of the observations did not subscribe. But we cannot say there is any pattern, since this is the case within the whole population.

## contact

```{r}
ggplot(data, aes(fill=y, y=..count.., x=contact)) + 
    geom_bar(position="stack", stat="count")
```

It seems that people who are contacted by celluar are more likely to subscribe.

## housing

```{r}
ggplot(data, aes(fill=y, y=..count.., x=housing)) + 
    geom_bar(position="stack", stat="count")
```

There aren't significant difference in the `housing` section.

## loan

```{r}
ggplot(data, aes(fill=y, y=..count.., x=loan)) + 
    geom_bar(position="stack", stat="count")
```

## month

```{r}
ggplot(data, aes(fill=y, y=..count.., x=month)) + 
    geom_bar(position="stack", stat="count")
```

From the plot, we can see that there are many more observation in May. However, the proportion of people subscribed are not optimal. Also, there are not many observations on December, March, October, September, but the proportion of subscriptions is pretty high.

## day_of_week

```{r}
ggplot(data, aes(fill=y, y=..count.., x=day_of_week)) + 
    geom_bar(position="stack", stat="count")
```

There aren't siginificant differences in `day_of_week`.

## duration

```{r, warning = FALSE}
ggplot(data, aes(fill=y, y=..count.., x=duration)) + 
    geom_histogram()
```

When duration is near 0, almost no one subscribed. However, as duration increases, it seems that the proportion of people who subscribed increases.

## campaign

```{r}
ggplot(data, aes(fill=y, y=..count.., x=campaign)) + 
    geom_bar(position="stack", stat="count")
```

## pdays

```{r}
# may be change level 999?
ggplot(data, aes(fill=y, y=..count.., x=pdays)) + 
    geom_bar(width = 100, position="stack", stat="count")
```

## previous

```{r, warning = FALSE}
ggplot(data, aes(fill=y, y=..count.., x=previous)) + 
    geom_bar(position="stack", stat="count")
```

## poutcome

```{r}
ggplot(data, aes(fill=y, y=..count.., x=poutcome)) + 
    geom_bar(position="stack", stat="count")
```

From the plot, we found that if previous marketing campagin succeeded, people are more likely to subscribe.

## emp.var.rate

```{r}
ggplot(data, aes(fill=y, y=..count.., x=emp.var.rate)) + 
    geom_histogram(bins=5)
```

## cons.price.idx

```{r}
ggplot(data, aes(fill=y, y=..count.., x=cons.price.idx)) + 
    geom_histogram(bins=5)
```

## cons.conf.idx

```{r}
ggplot(data, aes(fill=y, y=..count.., x=cons.conf.idx)) + 
    geom_histogram(bins=5)
```

## euribor3m

```{r}
ggplot(data, aes(fill=y, y=..count.., x=euribor3m)) + 
    geom_histogram(bins=5)
```

## nr.employed

```{r}
ggplot(data, aes(fill=y, y=..count.., x=nr.employed)) + 
    geom_histogram(bins=4)
```

# Modeling



# Results